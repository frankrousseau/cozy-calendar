// Generated by CoffeeScript 1.10.0
var Settings;

Settings = require('../models/settings');

module.exports = {
  update: function(req, res, next) {
    req.checkBody({
      defaultCalendar: {
        notEmpty: true,
        isString: true,
        errorMessage: 'Invalid calendar name'
      }
    });
    return req.getValidationResult().then(function(result) {
      var responseBody;
      if (!result.isEmpty()) {
        responseBody = {
          success: false,
          error: result.array()
        };
        return res.status(400).send(responseBody);
      }
      return Settings.getCalAppSettings(function(err, setting) {
        var newSettings;
        if (err) {
          return next(err);
        }
        newSettings = {
          defaultCalendar: req.body.defaultCalendar
        };
        return Settings.updateCalAppSettings(newSettings, function(err, calSettings) {
          if (err) {
            return next(err);
          }
          return res.send({
            success: true,
            settings: calSettings
          });
        });
      });
    });
  }
};
